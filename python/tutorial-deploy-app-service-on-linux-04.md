---
title: Руководство по Настройка пользовательского файла с командой запуска для приложений Python в Службе приложений Azure в Linux
description: Шаг руководства 4. Настройка режима запуска веб-приложения в Службе приложений
services: app-service
author: kraigb
manager: barbkess
ms.service: app-service
ms.topic: conceptual
ms.date: 09/12/2019
ms.author: kraigb
ms.custom: seo-python-october2019
ms.openlocfilehash: 7c3c863ed333528c675cda939f52b86f53bc8380
ms.sourcegitcommit: 6012460ad8d6ff112226b8f9ea6da397ef77712d
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/11/2019
ms.locfileid: "72278944"
---
# <a name="tutorial-configure-a-custom-startup-file-for-python-apps-on-azure-app-service"></a>Руководство по Настройка пользовательского файла с командой запуска для приложений Python в Службе приложений Azure

[Предыдущий шаг: создание Службы приложений](tutorial-deploy-app-service-on-linux-03.md)

В этой статье описано, как настроить пользовательский файл запуска для приложения Python в Службе приложений Azure.

В зависимости от структуры приложения вам может потребоваться пользовательский файл с командой запуска (см. руководстве по [настройке приложений Python для Службы приложений в Linux](https://docs.microsoft.com/azure/app-service/containers/how-to-configure-python) в документации Azure).

Ниже перечислены сценарии использования такого файла:

- У вас есть приложение **Flask**, файл запуска и объект приложения которого имеют имена, **отличающиеся** от *application.py* и `app` соответственно. Иными словами, если в корневой папке проекта нет файла *application.py* *и* имя объекта приложения Flask отличается от `app`, вам потребуется пользовательский файл с командой запуска.
- Вам нужно запускать веб-сервер Gunicorn с дополнительными аргументами, кроме тех, которые используются по умолчанию `--bind=0.0.0.0 --timeout 600`.

## <a name="create-a-startup-file"></a>Создание файла запуска

Если вам нужен пользовательский файл запуска, выполните следующие действия:

1. Создайте в проекте файл с именем *startup.txt* (или с любым другим на ваш выбор), который содержит команду запуска. [Команды запуска Flask](#flask-startup-commands) описаны в следующем разделе. Для приложений Django дополнительная настройка обычно не требуется.

1. Сохраните этот файл в репозитории кода, чтобы его можно было развернуть с остальной частью приложения.

1. В области **Azure: Служба приложений** разверните Службу приложений, щелкните правой кнопкой мыши **Параметры приложения** и выберите **Открыть на портале**:

    ![Пункт "Открыть параметры приложения на портале" в обозревателе Службы приложений](media/deploy-azure/open-application-settings-in-portal-for-app-service.png)

1. На портале Azure выполните вход, если потребуется, затем на странице **Конфигурация** выберите **Общие параметры**, введите имя файла запуска (например, *startup.txt*) из раздела **Параметры стека** > **Команда запуска** и щелкните **Сохранить**.

    ![Настройка имени для файла с командой запуска на портале Azure](media/deploy-azure/enter-startup-file-for-app-service-in-the-azure-portal.png)

    > [!NOTE]
    > Вместо файла с командой запуска вы можете указать команду запуска непосредственно в поле **Команда запуска** на портале Azure. Но обычно лучше использовать файл, так как он позволяет сохранить этот элемент конфигурации в репозитории, чтобы вы могли при необходимости отслеживать изменения и развертывать его в других экземплярах службы приложений.

1. Служба приложений перезапускается при сохранении изменений. Но вы пока еще не развернули код приложения, поэтому при входе на веб-сайт пока будете получать ошибку, связанную с работой приложения. Такое сообщение означает, что сервер Gunicorn запущен, но не может найти приложение, то есть HTTP-запросы не обрабатываются. Код приложения вы развернете на следующем шаге.

## <a name="django-startup-commands"></a>Команды запуска Django

По умолчанию Служба приложений автоматически обнаруживает папку с файлом *wsgi.py* и запускает Gunicorn с помощью следующей команды:

```bash
# <module> is the path to the folder that contains wsgi.py
gunicorn --bind=0.0.0.0 --timeout 600 <module>.wsgi
```

Если вы хотите изменить аргументы Gunicorn, например применить `--timeout 1200`, создайте командный файл с нужными изменениями.

## <a name="flask-startup-commands"></a>Команды запуска Flask

По умолчанию контейнер Службы приложений в Linux предполагает, что файл запуска для приложения Flask называется *application.py* и находится в корневой папке приложения. Также он ожидает, что в этом файле определен объект приложения Flask с именем `app`. Если ваше приложение имеет другую структуру, с помощью пользовательской команды запуска задайте расположение объекта приложения:

1. **Другое имя файла и (или) объекта приложения**. Например, если вы используете файл запуска *hello.py* и объект приложения `myapp`, используйте такую команду запуска:

    ```text
    gunicorn --bind=0.0.0.0 --timeout 600 hello:myapp
    ```

1. **Файл запуска находится во вложенной папке**. Например, если вы используете файл запуска *myapp/website.py* и объект приложения `app`, с помощью аргумента Gunicorn `--chdir` укажите папку, а затем обычным образом используйте имя файла и объект приложения:

    ```text
    gunicorn --bind=0.0.0.0 --timeout 600 --chdir myapp website:app
    ```

1. **Файл запуска расположен в модуле**. В коде [python-sample-vscode-flask-tutorial](https://github.com/Microsoft/python-sample-vscode-flask-tutorial) файл запуска *webapp.py* помещен в папку *hello_app*, который в свою очередь является модулем в файле *\_\_init\_\_.py*. Объект приложения имеет имя `app` и определен в файле *\_\_init\_\_.py*, а *webapp.py* использует относительный импорт. В такой конфигурации указание `webapp:app` для Gunicorn приводит к ошибке Attempted relative import in non-package (Попытка относительного импорта вне пакета) и сбою при запуске приложения.

    Чтобы устранить проблему, создайте специальный файл, который импортирует объект приложения из модуля, а затем настройте Gunicorn на соответствующий запуск приложения. Например, код [python-sample-vscode-flask-tutorial](https://github.com/Microsoft/python-sample-vscode-flask-tutorial) содержит файл *startup.py* со следующим содержимым:

    ```python
    # startup.py shim
    from hello_app.webapp import app
    ```

    Для него нужна такая команда запуска:

    ```text
    gunicorn --bind=0.0.0.0 --timeout 600 startup:app
    ```

> [!div class="nextstepaction"]
> [Файл запуска уже настроен](tutorial-deploy-app-service-on-linux-05.md)

[У меня есть проблема](https://www.research.net/r/PWZWZ52?tutorial=vscode-appservice-python&step=04-startup-command)
