---
title: Устранение проблем с сетью при использовании пакета Azure SDK для Java
description: Общие сведения об устранении неполадок с сетью, связанных с использованием пакета Azure SDK для Java.
author: alzimmermsft
ms.date: 02/02/2021
ms.topic: conceptual
ms.custom: devx-track-java
ms.author: alzimmer
ms.openlocfilehash: 63852f253a648e473ba91ac361bc5d9d0629b8f1
ms.sourcegitcommit: 71847ee0a1fee3f3320503629d9a8c82319a1f6a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/03/2021
ms.locfileid: "99528587"
---
# <a name="troubleshoot-networking-issues"></a>Устранение проблем с сетями

В этой статье описываются некоторые средства, которые умеют диагностировать проблемы с сетью различной сложности. К ним относится широкий набор сценариев — от устранения неполадок при непредвиденном значении ответа от службы до поиска причин исключения, вызывающего завершение подключения.

Для устранения неполадок на стороне клиента клиентские библиотеки Azure для Java предлагают согласованную и надежную систему журналов, которая описана в статье [Настройка ведения журнала в пакете Azure SDK для Java](logging-overview.md). Но клиентские библиотеки выполняют сетевые вызовы по различным протоколам, что может привести к необходимости дополнительных, не описанных здесь действий по устранению неполадок. При возникновении таких проблем следует применить для диагностики внешние средства, описанные в этой статье.

## <a name="fiddler"></a>Fiddler

[Fiddler](https://docs.telerik.com/fiddler-everywhere/introduction) — это прокси-сервер отладки HTTP, который позволяет регистрировать в точном виде все запросы и ответы, передаваемые через него. Сохраненные и неизмененные запросы и ответы могут помочь при устранении неполадок в сценариях, когда служба получает непредвиденный запрос или клиент получает непредвиденный ответ. Чтобы использовать Fiddler, необходимо настроить клиентскую библиотеку с прокси-сервером HTTP. При использовании протокола HTTPS потребуется дополнительная настройка, чтобы получить возможность проверять расшифрованные тексты запросов и ответов.

### <a name="add-an-http-proxy"></a>Добавление прокси-сервера HTTP

Чтобы добавить прокси-сервер HTTP, следуйте указаниям в статье [Настройка прокси-серверов в пакете Azure SDK для Java](proxying.md). Обязательно укажите адрес Fiddler по умолчанию: `localhost` с портом 8888.

### <a name="enable-https-decryption"></a>Включение расшифровки протокола HTTPS

По умолчанию Fiddler может собирать только HTTP-трафик. Если приложение использует протокол HTTPS, необходимо выполнить дополнительные действия, чтобы оформить доверие сертификату Fiddler и позволить ему собирать трафик HTTPS. Дополнительные сведения см. в разделе [о меню HTTPS](https://docs.telerik.com/fiddler-everywhere/user-guide/settings/https) в документации по Fiddler.

В следующих процедурах описывается, как с помощью среды выполнения Java (JRE) настроить доверие сертификату. Без доверия сертификату HTTPS-запрос через Fiddler может неожиданно завершиться с предупреждениями безопасности.

**Linux/macOS**

1. Экспортируйте сертификат Fiddler.
1. Найдите средство keytool для JRE (обычно располагается в каталоге `jre/bin`).
1. Найдите сертификат центра сертификации для JRE (обычно располагается в каталоге `jre/lib/security`).
1. Откройте окно Bash и выполните следующую команду, чтобы импортировать сертификат:

   ```bash
   sudo keytool -import -file <location of Fiddler certificate> -keystore <location of cacert> -alias Fiddler
   ```

1. Введите пароль.
1. Подтвердите доверие сертификату.

**Windows**

1. Экспортируйте сертификат Fiddler.
1. Найдите средство keytool для JRE (обычно располагается в каталоге `jre\bin`).
1. Найдите сертификат центра сертификации для JRE (обычно располагается в каталоге `jre\lib\security`).
1. Откройте командную строку и выполните следующую команду, чтобы импортировать сертификат:

   ```cmd
   keytool.exe -import -file <location of Fiddler certificate> -keystore <location of cacert> -alias Fiddler
   ```

1. Введите пароль.
1. Подтвердите доверие сертификату.

## <a name="wireshark"></a>Wireshark

[Wireshark](https://www.wireshark.org/) представляет собой анализатор сетевых протоколов, который умеет собирать сетевой трафик без внесения изменений в код приложения. Wireshark обеспечивает широкие возможности настройки и может собирать весь трафик целиком или с конкретными параметрами на низком уровне. Эта возможность полезна при устранении неполадок, например при завершении подключения удаленным узлом или при завершении подключений при выполнении операции. Графический пользовательский интерфейс Wireshark отображает записи с использованием цветовой схемы, которая позволяет различать уникальные записи, такие как повторная передача TCP, RST и т. д. Можно также фильтровать записи в процессе сбора или анализа.

### <a name="configure-a-capture-filter"></a>Настройка фильтра сбора

Фильтры сбора сокращают количество сетевых вызовов, сохраняемых для анализа. Без фильтров сбора Wireshark захватывает весь трафик, который проходит через сетевой интерфейс. Такое поведение может привести к созданию больших объемов данных, при том что значительная часть этих данных может не иметь отношения к расследованию. С помощью фильтра сбора вы можете заранее сократить собираемый сетевой трафик, чтобы сосредоточиться на конкретном расследовании. Дополнительные сведения см. в разделе [о сборе динамических сетевых данных](https://www.wireshark.org/docs/wsug_html_chunked/ChapterCapture.html) в документации по Wireshark.

Следующий пример добавляет фильтр сбора для записи сетевого трафика, отправленного c конкретного узла или полученного от него.

В Wireshark откройте **Capture > Capture Filters...** (Сбор — Фильтры сбора...) и добавьте новый фильтр со значением `host <host IP or hostname>`. Этот фильтр будет собирать трафик только с указанного узла и на него. Если приложение взаимодействует с несколькими узлами, можно добавить несколько фильтров сбора или объединить IP-адреса или имена этих узлов с помощью логического оператора ИЛИ. Так вы организуете менее строгую фильтрацию сбора.

### <a name="capture-to-disk"></a>Сбор на диск

Возможно, для воспроизведения непредвиденного сетевого исключения и анализа предшествующего трафика потребуется длительное время отслеживать работу приложения. Кроме того, не всегда возможно хранить в памяти все собранные состояния. К счастью, Wireshark умеет сохранять записи на диск для последующей обработки. Такой подход позволяет избежать нехватки памяти при воспроизведении проблемы. Дополнительные сведения см. в разделе [File Input, Output, And Printing](https://www.wireshark.org/docs/wsug_html_chunked/ChapterIO.html) (Ввод в файлы, а также вывод и печать из них) в документации по Wireshark.

В следующем примере выполняется настройка Wireshark для сохранения записей на диск в нескольких файлах, каждый из которых содержит не более 100 тысяч записей или имеет размер не более 50 МБ.

В Wireshark перейдите к разделу **Capture > Options** (Сбор — Параметры) и найдите вкладку **Output** (Выходные данные). Введите здесь имя файла для использования. В такой конфигурации Wireshark будет сохранять все записи в один файл. Чтобы включить сбор записей в несколько файлов, выберите **Create a new file automatically** (Создавать новый файл автоматически), а также параметры **after 100000 packets** (после 100 000 пакетов) и **after 50 megabytes** (после 50 МБ). В этой конфигурации Wireshark будет создавать новый файл при совпадении одного из условий. Каждый новый файл получает единое базовое имя, которое вы ввели, с добавлением уникального идентификатора. Если вы хотите ограничить количество файлов, которое может создать Wireshark, выберите **Use a ring buffer with X files** (Использовать кольцевой буфер с X файлов). Этот параметр указывает Wireshark создавать ограниченное число файлов журнала. При достижении этого количества файлов Wireshark будет перезаписывать файлы, начиная с самого старого.

### <a name="filter-captures"></a>Фильтрация записей

Иногда у вас не будет возможности ограничить трафик, собираемый в Wireshark, например, если приложение взаимодействует с несколькими узлами по нескольким протоколам. В этом сценарии обычно проще применить постоянную запись, как описано выше, а анализ выполнять после сбора данных о сети. Wireshark поддерживает для анализа записей синтаксис, похожий на фильтрацию. Дополнительные сведения см. в разделе [о работе с собранными пакетами](https://www.wireshark.org/docs/wsug_html_chunked/ChapterWork.html) в документации по Wireshark.

Следующий пример загружает сохраненный файл записей и фильтрует его по `ip.src_host==<IP>`.

Перейдите в Wireshark к разделу **File > Open** (Файл — Открыть) и загрузите сохраненную запись из указанного выше расположения файла. Когда завершится загрузка файла, под строкой меню отобразится поле ввода для фильтра. В поле ввода для фильтра укажите `ip.src_host==<IP>`. Этот фильтр ограничит представление записей таким образом, чтобы отображать только записи, источником которых является узел с IP-адресом `<IP>`.

## <a name="next-steps"></a>Следующие шаги

В этом разделе были рассмотрены различные средства для диагностики сетевых проблем при работе с пакетом Azure SDK для Java. Теперь, когда вы ознакомились с высокоуровневыми сценариями использования, можете приступить к изучению самого пакета SDK. Дополнительные сведения о доступных API см. в статье [Библиотеки Azure SDK для Java](azure-sdk-library-package-index.md).
