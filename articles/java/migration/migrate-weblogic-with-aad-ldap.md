---
title: Авторизация и аутентификация пользователей с помощью Azure Active Directory для переноса приложений Java в WebLogic Server в Azure
description: В этом руководстве описывается, как настроить Oracle WebLogic Server для подключения к доменным службам Azure Active Directory с помощью протокола LDAP.
author: edburns
ms.author: edburns
ms.topic: tutorial
ms.date: 08/10/2020
ms.openlocfilehash: b1437362601e990b560dc0385420605ef01a426a
ms.sourcegitcommit: 4049dc6109600a8308ba5617cc122a5b32cc4ca1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/28/2020
ms.locfileid: "89056287"
---
# <a name="end-user-authorization-and-authentication-for-migrating-java-apps-on-weblogic-server-to-azure"></a>Авторизация и аутентификация пользователей для переноса приложений Java в WebLogic Server в Azure

В этом руководстве показано, как включить аутентификацию и авторизацию пользователей корпоративного уровня для приложений Java в WebLogic Server с помощью Azure Active Directory.

Разработчики Java EE ожидают, что [стандартные механизмы обеспечения безопасности платформы](https://javaee.github.io/tutorial/security-intro.html#BNBWJ) будут "просто работать" даже при перемещении рабочих нагрузок в Azure.  Выполнив инструкции из статьи [Приложения Azure на Oracle WebLogic Server (WLS)](/azure/virtual-machines/workloads/oracle/oracle-weblogic), вы сможете включить во встроенную область безопасности пользователей из доменных служб Azure Active Directory (Azure AD DS).  Используйте стандартный элемент `<security-role>` в приложениях Azure на Java EE; сведения о пользователях передаются из Azure AD DS по протоколу LDAP.

Это руководство разделено на две части.  Если у вас уже развернуты службы Azure AD DS с защищенным протоколом LDAP, вы можете сразу перейти ко второй части.

* [Настройка Azure Active Directory](#azure-active-directory-configuration)
* [Настройка WLS](#wls-configuration)

Из этого руководства вы узнаете, как выполнить следующие задачи:

> [!div class="checklist"]
> * созданию и настройке управляемого домена доменных служб Azure Active Directory
> * настройка защищенного протокола LDAP для управляемого домена Azure AD DS;
> * включение доступа к LDAP в качестве области безопасности по умолчанию для WebLogic Server.

В этом руководстве не приводятся инструкции по перенастройке существующего развертывания Azure AD, но при необходимости вы сможете пропустить некоторые шаги из него.

## <a name="prerequisites"></a>Предварительные требования

* Активная подписка Azure.
  * Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/).
* Возможность развернуть одно из приложений Azure на WLS, указанных в статье [Приложения Azure на Oracle WebLogic Server](/azure/virtual-machines/workloads/oracle/oracle-weblogic).

## <a name="migration-context"></a>Контекст миграции

Ниже приведены некоторые моменты, которые следует учитывать при переносе локальных установок WLS и Azure AD.

* Если у вас уже есть арендатор Azure AD без доменных служб, доступ к которым предоставляется через LDAP, это руководство поможет вам включить возможности LDAP и интегрировать их с WLS.
* Если в вашем сценарии используется локальный лес Active Directory, примените решение гибридной идентификации на основе Azure AD.  Дополнительные сведения см. в [документации по гибридной идентификации](/azure/active-directory/hybrid/).
* Если у вас уже есть локальное развертывание доменных служб Active Directory (AD DS), изучите пути миграции, описанные в статье [Сравнение самостоятельно управляемых доменных служб Active Directory, Azure Active Directory и управляемых доменных служб Azure Active Directory](/azure/active-directory-domain-services/compare-identity-solutions).
* Если вы оптимизируете облако, это руководство поможет вам начать с нуля работу с LDAP в Azure AD DS и WLS.
* Полный обзор миграции сервера с помощью WebLogic Server на Виртуальные машины Azure см. в статье [Миграция приложений WebLogic в Виртуальные машины Azure](migrate-weblogic-to-virtual-machines.md).

## <a name="azure-active-directory-configuration"></a>Настройка Azure Active Directory

В этом разделе описаны все действия по развертыванию экземпляра Azure AD DS, интегрированного с WLS.  Azure Active Directory не поддерживает протокол LDAP или защищенный протокол LDAP напрямую. Такая поддержка обеспечивается через экземпляр доменных служб Azure AD (Azure AD DS) в арендаторе Azure AD.

>[!NOTE]
> В этом руководстве используется функция полностью облачной учетной записи пользователя в Azure AD DS.  Другие типы учетных записей пользователей поддерживаются, но не описываются в этом руководстве.

### <a name="create-and-configure-an-azure-active-directory-domain-services-managed-domain"></a>созданию и настройке управляемого домена доменных служб Azure Active Directory

В этом разделе приводятся отдельные инструкции по развертыванию управляемого домена Azure AD DS.

Выполните инструкции из руководства [Создание и настройка управляемого домена доменных служб Azure Active Directory](/azure/active-directory-domain-services/tutorial-create-instance) до раздела [Включение учетных записей пользователей для Azure AD DS](/azure/active-directory-domain-services/tutorial-create-instance#enable-user-accounts-for-azure-ad-ds) (не включая его).  Работа с этим разделом отличается в контексте этого руководства, как описано в следующем разделе.  Обязательно полностью и правильно выполните действия по настройке DNS.

Запишите значение, которое вы указали при выполнении шага "Введите доменное имя DNS для управляемого домена".  Оно будет использоваться далее в этой статье.

### <a name="create-users-and-reset-passwords"></a>Создание пользователей и сброс паролей

В этом разделе описывается, как создать пользователей и изменить их пароли, что требуется для успешного распространения пользователей через LDAP.  Если у вас уже установлены службы Azure AD DS, этот шаг необязателен.

1. На портале Azure проверьте, что каталог, соответствующий арендатору Azure AD, является активным.  Чтобы узнать, как выбрать правильный каталог, см. статью [Связывание или добавление подписки Azure в арендатор Azure Active Directory](/azure/active-directory/fundamentals/active-directory-how-subscriptions-associated-directory).  Если выбран неправильный каталог, вы не сможете создать пользователей или создадите их в неправильном каталоге.
1. В поле поиска в верхней части портала Azure введите "Пользователи".
1. Выберите **Новый пользователь**.
1. Убедитесь, что вы выбрали вариант **Создать пользователя**.
1. Укажите имя пользователя, имя и фамилию.  В остальных полях оставьте значения по умолчанию.
1. Нажмите кнопку **создания**.
1. Выберите созданного пользователя в таблице.
1. Выберите **Сбросить пароль**.
1. На открывшейся панели выберите **Сбросить пароль**.
1. Запишите временный пароль.
1. В окне браузера в режиме инкогнито откройте [портал Azure](https://portal.azure.com/) и выполните вход с учетными данными и паролем пользователя.
1. В ответ на запрос измените пароль.  Запишите новый пароль.  Он понадобится вам позже.
1. Выйдите и закройте окно в режиме инкогнито.

Повторите действия от "Выберите **Создать пользователя**" до "Выйдите и закройте" для каждого пользователя, которого вы хотите активировать.

### <a name="allow-ldap-in-azure-ad-ds"></a>Включение LDAP в Azure AD DS

В этом разделе приведены отдельные инструкции по извлечению значений для использования в настройке WLS.

Сначала откройте руководство [Настройка защищенного протокола LDAP для управляемого домена доменных служб Azure AD](/azure/active-directory-domain-services/tutorial-configure-ldaps) в отдельном окне браузера, чтобы вы могли учитывать приведенные ниже варианты при выполнении инструкций из него.  

Когда вы дойдете до раздела [Экспорт сертификата для клиентских компьютеров](/azure/active-directory-domain-services/tutorial-configure-ldaps#export-a-certificate-for-client-computers), запишите расположение, в которое вы сохранили файл сертификата с расширением *.cer*.  Мы будем использовать сертификат в качестве входных данных для настройки WLS.

Когда вы дойдете до раздела [Блокировка доступа по защищенному протокол LDAP через Интернет](/azure/active-directory-domain-services/tutorial-configure-ldaps#lock-down-secure-ldap-access-over-the-internet), укажите для источника значение **Любой**.  Дальше в этом руководстве показано, как сделать правило безопасности более строгим, указав определенный IP-адрес.

Прежде чем выполнять действия из раздела [Проверка запросов к управляемому домену](/azure/active-directory-domain-services/tutorial-configure-ldaps#test-queries-to-the-managed-domain), выполните следующие шаги, чтобы проверка была успешной.

   1. На портале откройте страницу обзора для экземпляра Azure AD DS.
   1. В области параметров выберите **Свойства**.
   1. В правой части страницы прокрутите вниз до раздела **Группа администраторов**.  Под этим заголовком вы найдете ссылку на группу **Администраторы контроллера доменов AAD**.  Выберите эту ссылку.
   1. В разделе **Управление** выберите **Участники**.
   1. Выберите **Добавить участников**.
   1. В текстовое поле **Поиск** введите символы из имени одного из пользователей, которых вы создали на предыдущем шаге, чтобы найти это имя.
   1. Выберите пользователя и нажмите кнопку **Выбрать**.
   1. Этот пользователь понадобится вам при выполнении шагов из раздела **Проверка запросов к управляемому домену**.
   >[!NOTE]
   >
   > Ниже приведены советы по выполнению запросов к данным LDAP, что потребуется вам для сбора некоторых значений для настройки WLS.
   >
   > * В этом руководстве используется программа Windows *LDP.exe*.  Эта программа доступна только в Windows.  Пользователи, которые не работают с Windows, для этой цели могут использовать [Apache Directory Studio](https://directory.apache.org/studio/downloads.html).
   > * При входе в LDAP с помощью *LDP.exe* именем пользователя является часть до знака @.  Например, если вы используете пользователя `alice@contoso.onmicrosoft.com`, для действия привязки *LDP.exe* нужно указать имя пользователя `alice`.  Кроме того, оставьте программу *LDP.exe* запущенной с открытым сеансом входа для использования в последующих шагах.
   >
При выполнении инструкций из раздела [Настройка зоны DNS для внешнего доступа](/azure/active-directory-domain-services/tutorial-configure-ldaps#configure-dns-zone-for-external-access) запишите значение **внешнего IP-адреса защищенного протокола LDAP**.  Он понадобится вам позже.

Если значение **внешнего IP-адреса защищенного протокола LDAP** выражено неочевидно, выполните описанные ниже действия, чтобы получить IP-адрес.

1. На портале найдите группу ресурсов, содержащую ресурс доменных служб Azure AD.
1. В списке ресурсов выберите ресурс общедоступного IP-адреса для ресурса доменных служб Azure AD, как показано далее.  Вероятно, общедоступный IP-адрес будет начинаться с `aads`.
   :::image type="content" source="media/migrate-weblogic-with-aad-ldap/alternate-secure-ip-address-technique.png" alt-text="Окно браузера с демонстрацией выбора общедоступного IP-адреса.":::
1. Общедоступный IP-адрес отображается рядом с меткой **IP-адреса**.

Не выполняйте действия из раздела [Очистка ресурсов](/azure/active-directory-domain-services/tutorial-configure-ldaps#clean-up-resources), пока об этом не будет сказано в этом руководстве.

Учитывая сказанное выше, выполните инструкции из статьи [Руководство по настройке защищенного протокола LDAP для управляемого домена доменных служб Azure AD](/azure/active-directory-domain-services/tutorial-configure-ldaps).  Теперь мы можем собрать значения для указания в конфигурации WLS.

>[!NOTE]
> Прежде чем переходить к следующему разделу, подождите, пока завершится обработка конфигурации защищенного протокола LDAP.

### <a name="disable-weak-tls-v1"></a>Отключение ненадежного TLS v1

По умолчанию доменные службы Azure Active Directory (Azure AD DS) позволяют использовать TLS v1, который считается ненадежным и не поддерживается в WebLogic Server 14 и более поздних версиях. 

Здесь описывается процедура отключения шифров TLS v1.

Сначала получите идентификатор ресурса экземпляра доменной службы Azure, который включает протокол LDAP. В следующем примере возвращается идентификатор экземпляра доменной службы Azure с именем `aaddscontoso.com` в группе ресурсов `aadds-rg`.

```azurecli
AADDS_ID=$(az resource show --resource-group aadds-rg --resource-type "Microsoft.AAD/DomainServices" --name aaddscontoso.com --query "id" --output tsv)
```

Для отключения TLS v1 выполните приведенную ниже команду:

```azurecli
az resource update --ids $AADDS_ID --set properties.domainSecuritySettings.tlsV1=Disabled
```

Выходные данные отображают `"tlsV1": "Disabled"` для `domainSecuritySettings`, как показано в следующем примере:

```text
"domainSecuritySettings": {
      "ntlmV1": "Enabled",
      "syncKerberosPasswords": "Enabled",
      "syncNtlmPasswords": "Enabled",
      "syncOnPremPasswords": "Enabled",
      "tlsV1": "Disabled"
}
```

Дополнительные сведения см. в статье [Отключение ненадежных шифров и синхронизации хэшей паролей для обеспечения безопасности управляемого домена доменных служб Azure Active Directory](/azure/active-directory-domain-services/secure-your-domain).

## <a name="wls-configuration"></a>Настройка WLS

Выполнив инструкции из этого раздела, вы соберете значения параметров из служб Azure AD DS, развернутых ранее.

При развертывании приложений Azure, указанных в статье [Приложения Azure на Oracle WebLogic Server](/azure/virtual-machines/workloads/oracle/oracle-weblogic), вы можете выбрать автоматическое подключение развертывания к существующему серверу LDAP.  Вы также можете настроить подключение к LDAP позднее с помощью подшаблона интеграции с Active Directory.  Этот подход описан в приложении A [официальной документации](https://wls-eng.github.io/arm-oraclelinux-wls/).  Так или иначе, вам нужны обязательные значения параметров для шаблона ARM.

| Имя параметра | Описание   | Сведения | 
|----------------|---------------|---------|
| `aadsServerHost` | Узел сервера | Это значение представлено общедоступным DNS-именем, которое вы сохранили при выполнении инструкций из [руководства по созданию и настройке управляемого домена доменных служб Azure Active Directory](/azure/active-directory-domain-services/tutorial-create-instance). |
| `aadsPublicIP` | Внешний IP-адрес защищенного протокола LDAP | Это значение представлено **внешним IP-адресом защищенного протокола LDAP**, который вы сохранили при выполнении инструкций из раздела [Настройка зоны DNS для внешнего доступа](/azure/active-directory-domain-services/tutorial-configure-ldaps#configure-dns-zone-for-external-access).|
| `wlsLDAPPrincipal` | Основной   | Вернитесь к *LDP.exe*.  Выполните следующие шаги, чтобы получить дополнительное значение для `wlsLDAPPrincipal`. <ol><li>В меню **Вид** выберите **Дерево**.</li><li>В диалоговом окне **Представление в виде дерева** оставьте значение **BaseDN** пустым и нажмите **OK**.</li><li>Щелкните правой кнопкой мыши в области справа и выберите **Очистить выходные данные**.</li><li>Разверните представление в виде дерева слева и выберите запись, которая начинается на OU=AADDC Users.</li><li>В меню **Обзор** выберите **Поиск**.</li><li>В появившемся диалоговом окне примите значения по умолчанию и нажмите кнопку **Выполнить**.</li><li>После отображения выходных данных в области справа выберите **Закрыть** рядом с кнопкой **Выполнить**.</li><li>Найдите в выходных данных запись **Dn**, соответствующую пользователю, которого вы добавили в группу администраторов контроллера домена AAD.  Она будет начинаться с **Dn: CN=&lt;имя пользователя&gt;OU=AADDC Users**.</li></ol> |
| `wlsLDAPGroupBaseDN` и `wlsLDAPUserBaseDN` | Базовое различающееся имя пользователя и базовое различающееся имя группы | В этом руководстве используемые значения двух этих свойств одинаковы — это часть **wlsLDAPPrincipal** после первой запятой.|
| `wlsLDAPPrincipalPassword` | Пароль для субъекта | Это значение является паролем для пользователя, добавленного в группу **Администраторы контроллера домена AAD**. |
| `wlsLDAPProviderName` | Provider Name | Вы можете оставить значение по умолчанию.  Оно используется в качестве имени поставщика аутентификации в WLS. |
| `wlsLDAPSSLCertificate` | Доверенное хранилище ключей для конфигурации SSL | Это значение представляет собой файл *.cer*, который вы должны были сохранить при выполнении шага [Экспорт сертификата для клиентских компьютеров](/azure/active-directory-domain-services/tutorial-configure-ldaps#export-a-certificate-for-client-computers).

### <a name="integrating-azure-ad-ds-ldap-with-wls"></a>Интеграция LDAP Azure AD DS с WLS

Имея приведенные выше значения конфигурации и развернув LDAP в Azure AD DS, теперь вы можете запустить настройку.  Существует два подхода к выполнению этого процесса.

#### <a name="during-wls-deployment"></a>Во время развертывания WLS

Прочитайте статью [Приложения Azure на Oracle WebLogic Server](/azure/virtual-machines/workloads/oracle/oracle-weblogic) и выберите сервер администрирования или одно из кластерных предложений.  При развертывании предложения на одной из вкладок вы увидите **Azure Active Directory**.  Установите для переключателя **Подключиться к Azure Active Directory** значение **Да**.  Укажите значения с учетом собранных ранее данных.  Чтобы задать сертификат, вы вам нужно напрямую отправить файл `.cer`.

#### <a name="after-wls-deployment"></a>После развертывания WLS

Если вы не установили для переключателя **Подключиться к Azure Active Directory** значение **Да** в ходе развертывания, вы сможете позже использовать собранные ранее значения для настройки.  Подробные сведения см. в [официальной документации](https://wls-eng.github.io/arm-oraclelinux-wls/).

### <a name="validate-the-deployment"></a>Проверка развертывания

После развертывания WLS и настройки LDAP с помощью одного из приведенных выше методов выполните следующие шаги, чтобы убедиться в успешности интеграции.

1. Откройте консоль администратора WLS.
1. В области навигации слева разверните дерево и выберите **Security Realms (Области безопасности)**  -> **myrealm** -> **Providers (Поставщики)** .
1. Если интеграция прошла успешно, вы найдете поставщика AAD, например `AzureActiveDirectoryProvider`.
1. В области навигации слева разверните дерево и выберите **Security Realms (Области безопасности)**  -> **myrealm** -> **Users and Groups (Пользователи и группы)** .
1. Если интеграция прошла успешно, вы найдете пользователей от поставщика AAD.

### <a name="lock-down-and-secure-ldap-access-over-the-internet"></a>Блокировка и защита доступа по протоколу LDAP через Интернет

При развертывании защищенного протокола LDAP на предыдущих шагах мы настроили источник как **Любой** для правила `AllowLDAPS` в группе безопасности сети.  Теперь, когда сервер администрирования WLS развернут и подключен к LDAP, получите его общедоступный IP-адрес на портале Azure.  Вернитесь к разделу [Блокировка доступа по защищенному протокол LDAP через Интернет](/azure/active-directory-domain-services/tutorial-configure-ldaps?branch=pr-en-us-778#lock-down-secure-ldap-access-over-the-internet) и измените значение **Любой** на конкретный IP-адрес для сервера администрирования WLS.

## <a name="clean-up-resources"></a>Очистка ресурсов

Теперь выполните действия, описанные в разделе [Очистка ресурсов](/azure/active-directory-domain-services/tutorial-configure-ldaps#clean-up-resources) статьи [Руководство по настройке защищенного протокола LDAP для управляемого домена доменных служб Azure AD](/azure/active-directory-domain-services/tutorial-configure-ldaps#clean-up-resources).

## <a name="next-steps"></a>Дальнейшие действия

Изучите другие аспекты миграции приложений WebLogic Server в Azure.

> [!div class="nextstepaction"]
> [Миграция приложений WebLogic в Виртуальные машины Azure](/azure/developer/java/migration/migrate-weblogic-to-virtual-machines)
