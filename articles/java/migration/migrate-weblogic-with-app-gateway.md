---
title: Учебник по переносу кластера WebLogic Server в Azure с помощью Шлюза приложений Azure в качестве подсистемы балансировки нагрузки
description: В этом учебнике описан процесс развертывания WebLogic Server в Azure с помощью Шлюза приложений Azure в качестве подсистемы балансировки нагрузки
author: edburns
ms.author: edburns
ms.topic: tutorial
ms.date: 10/15/2020
ms.openlocfilehash: 7a4f130e82338dea7c4fd344cfbedb2ed7f88c67
ms.sourcegitcommit: 050c898df76a1af5feffe99e392a073b8ac9c19c
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/16/2020
ms.locfileid: "92137093"
---
# <a name="tutorial-migrate-a-weblogic-server-cluster-to-azure-with-azure-application-gateway-as-a-load-balancer"></a>Руководство по переносу кластера WebLogic Server в Azure с помощью Шлюза приложений Azure в качестве подсистемы балансировки нагрузки

В этом учебнике описан процесс развертывания WebLogic Server (WLS) с помощью Шлюза приложений Azure.  В нем рассматриваются конкретные шаги по созданию Key Vault, хранению в нем SSL-сертификата и использованию этого сертификата для завершения SSL-запросов.  Хотя все эти элементы хорошо задокументированы сами по себе, в этом учебнике описывается конкретный способ объединения всех этих элементов для создания простого, но мощного решения балансировки нагрузки для WLS в Azure.

<!-- Diagram source at https://github.com/wls-eng/arm-oraclelinux-wls/blob/master/src/main/resources/weblogic-app-gateway-key-vault.vsdx -->

:::image type="content" border="false" source="media/migrate-weblogic-with-app-gateway/weblogic-app-gateway-key-vault.png" alt-text="Схема, на которой показана связь между WLS, Шлюзом приложений и Key Vault.":::

Балансировка нагрузки является важнейшей частью процесса переноса кластера Oracle WebLogic Server в Azure.  Самым простым решением является использование встроенной поддержки для [Шлюза приложений Azure](/azure/application-gateway/overview).  Шлюз приложений входит в состав поддержки кластера WebLogic в Azure.  Общие сведения о поддержке кластеров WebLogic в Azure см. в статье [Что представляет собой Oracle WebLogic Server в Azure?](/azure/virtual-machines/workloads/oracle/oracle-weblogic).

В этом руководстве описано следующее:

> [!div class="checklist"]
> * создать Azure Key Vault;
> * Создание SSL-сертификата
> * Сохранение SSL-сертификата в Key Vault
> * Развертывание WebLogic Server в Azure с помощью Шлюза приложений Azure
> * Проверка успешного развертывания WLS и Шлюза приложений

## <a name="prerequisites"></a>Предварительные требования

* [OpenSSL](https://www.openssl.org/) на компьютере под управлением UNIX-подобной среды командной строки.

   Хотя для управления сертификатами могут быть доступны и другие инструменты, в этом учебнике используется OpenSSL. OpenSSL поставляется со многими дистрибутивами GNU/Linux, например Ubuntu.
* Активная подписка Azure.
  * Если у вас еще нет подписки Azure, [создайте бесплатную учетную запись](https://azure.microsoft.com/free/).
* Возможность развернуть одно из приложений Azure на WLS, указанных в статье [Приложения Azure на Oracle WebLogic Server](/azure/virtual-machines/workloads/oracle/oracle-weblogic).

## <a name="migration-context"></a>Контекст миграции

Ниже приведены некоторые моменты, которые следует учитывать при переносе локальных установок WLS и Шлюза приложений Azure.  В то время как действия, описанные в этом учебнике, являются самым простым способом настроить балансировщик нагрузки перед кластером WebLogic Server в Azure, существует много других способов сделать это.  Необходимо учитывать также следующие факторы.

* Если у вас есть решение для балансировки нагрузки, убедитесь, что с его возможностями справляется Шлюз приложений Azure.  Сводные сведения о возможностях Шлюза приложений Azure по сравнению с другими решениями для балансировки нагрузки Azure см. в статье [Общие сведения о параметрах балансировки нагрузки в Azure](/azure/architecture/guide/technology-choices/load-balancing-overview).
* Если имеющееся решение для балансировки нагрузки обеспечивает защиту от распространенных эксплойтов и уязвимостей, Шлюз приложений предоставит вам все необходимые возможности. Встроенный в Шлюз приложений брандмауэр веб-приложения (WAF) реализует [основные наборы правил OWASP (открытого проекта безопасности веб-приложений)](https://www.owasp.org/index.php/Category:OWASP_ModSecurity_Core_Rule_Set_Project).  Дополнительные сведения о поддержке WAF в Шлюзе приложений см. в [этом разделе](/azure/application-gateway/features#web-application-firewall).
* Если для имеющегося решения балансировки нагрузки требуется сквозное шифрование SSL, необходимо выполнить дополнительную настройку, следуя шагам, описанным в этом руководстве.  См. раздел [Сквозное шифрование TLS](/azure/application-gateway/ssl-overview#end-to-end-tls-encryption) и документацию Oracle по [настройке SSL в Oracle Fusion Middleware](https://docs.oracle.com/en/middleware/fusion-middleware/12.2.1.3/asadm/configuring-ssl1.html#GUID-623906C0-B1FD-423F-AE51-061B5800E927).
* Если вы оптимизируете облако, это руководство поможет вам начать с нуля работу со Шлюзом приложений Azure и WLS.
* Полный обзор миграции сервера с помощью WebLogic Server на Виртуальные машины Azure см. в статье [Миграция приложений WebLogic в Виртуальные машины Azure](migrate-weblogic-to-virtual-machines.md).

## <a name="create-an-azure-key-vault"></a>создать Azure Key Vault;

В этом разделе показано, как использовать портал Azure для создания Azure Key Vault.

1. На **домашней странице** или в меню портала Azure выберите команду **Создать ресурс**.
1. В поле поиска введите **Key Vault**.
1. В списке результатов выберите **Key Vault**.
1. В разделе Key Vault выберите **Создать**.
1. В разделе **Создать Key Vault** введите приведенные ниже сведения.
    * **Подписка**: Выберите подписку.
    * В разделе **Группа ресурсов** выберите **Создать** и введите имя группы ресурсов.  Запишите имя хранилища ключей.  *Оно потребуется позже при развертывании WLS.*
    * **Имя Key Vault.** Укажите уникальное имя.  Запишите имя хранилища ключей.  *Оно потребуется позже при развертывании WLS.*
    > [!NOTE]
    > Вы можете использовать одно и то же имя как для **группы ресурсов**, так и для **имени Key vault**.
    * В раскрывающемся меню **Расположение** выберите расположение.
    * Для других параметров оставьте значения по умолчанию.
1. По завершении выберите **Next: политика доступа.**
1. В разделе **Разрешить доступ к** выберите **Azure Resource Manager для развертывания шаблонов**.
1. Выберите **Review + Create** (Просмотреть и создать).
1. Нажмите кнопку **создания**.

Создание хранилища ключей довольно упрощено и обычно завершается в пределах двух минут.  После завершения развертывания выберите **Перейти к ресурсу** и перейдите к следующему разделу.

## <a name="create-an-ssl-certificate"></a>Создание SSL-сертификата

В этом разделе показано, как создать самозаверяющий SSL-сертификат в формате, подходящем для Шлюза приложений, развернутого с помощью WebLogic в Azure.  Сертификат должен быть с непустым паролем.  Если у вас уже есть допустимый SSL-сертификат с непустым паролем в формате *PFX*, этот раздел можно пропустить и перейти к следующему.  Если имеющийся допустимый SSL-сертификат с непустым паролем не в формате *PFX*, прежде чем перейти к следующему разделу преобразуйте его в файл *PFX*.  В противном случае откройте командную оболочку и введите следующие команды.

> [!NOTE]
> В этом разделе показано, как кодировать сертификат в Base 64 перед сохранением его в качестве секрета в Key Vault.  Для этого требуется базовое развертывание Azure, которое создает WebLogic Server и Шлюз приложений.

Чтобы создать сертификаты и закодировать их в Base 64, выполните указанные ниже действия.

1. Создайте `RSA PRIVATE KEY`.

   ```bash
   openssl genrsa 2048 > private.pem
   ```
1. Создайте соответствующий открытый ключ.

   ```bash
   openssl req -x509 -new -key private.pem -out public.pem
   ```

   При появлении запроса средства OpenSSL необходимо будет ответить на несколько вопросов.  Эти значения будут включаться в сертификат.  В этом учебнике используется самозаверяющий сертификат, поэтому значения несущественны.  Введите следующие литеральные значения.
     1. В поле **Название страны** введите код из двух букв.
     1. В поле **State or Province Name** (Название штата или провинции) введите WA.
     1. Для поля **Название организации** введите Contoso.  Для поля "Имя подразделения" введите выставление счетов.
     1. Для поля **Общее имя** введите Contoso.
     1. В поле **Электронная почта** введите billing@contoso.com.

1. Экспортируйте сертификат как файл *PFX*.

   ```bash
   openssl pkcs12 -export -in public.pem -inkey private.pem -out mycert.pfx
   ```

   Дважды введите пароль.  Запишите пароль.  *Он потребуется позже при развертывании WLS.*

1. Выполните кодировку файла *mycert.pfx* в Base 64.

   ```bash
   base64 mycert.pfx > mycert.txt
   ```

Теперь, когда вы создали Key Vault и получили действительный SSL-сертификат с непустым паролем, можно сохранить сертификат в Key Vault.

## <a name="store-the-ssl-certificate-in-the-key-vault"></a>Сохранение SSL-сертификата в Key Vault

В этом разделе описано, как сохранить сертификат и его пароль в Key Vault, созданном в предыдущих разделах.

Для сохранения сертификата выполните приведенные ниже действия.

1. На портале Azure поместите курсор в строку поиска в верхней части страницы и введите имя хранилища Key Vault, созданного ранее в этом учебнике.
1. Ваше хранилище Key Vault должно отображаться под заголовком **Ресурсы**.  Выберите ее.
1. В разделе **Параметры** выберите **Секреты**.
1. Выберите **Создать или импортировать**.
1. В разделе **Параметры отправки** оставьте значение по умолчанию.
1. В разделе **Имя** введите `myCertSecretData` или нужное имя.
1. В разделе **Значение** введите содержимое файла *mycert.txt*.  Длина значения и наличие новой строки не являются проблемой для текстового поля.
1. Оставьте значения по умолчанию для остальных параметров и выберите **Создать**.

Для сохранения пароля сертификата выполните приведенные ниже действия.

1. Вернитесь на страницу **Секреты**.  Выберите **Создать или импортировать**.
1. В разделе **Параметры отправки** оставьте значение по умолчанию.
1. В разделе **Имя** введите `myCertSecretPassword` или нужное имя.
1. В разделе **Значение** введите пароль сертификата.
1. Оставьте значения по умолчанию для остальных параметров и выберите **Создать**.
1. Вернитесь на страницу **Секреты**.

## <a name="deploy-weblogic-server-with-application-gateway-to-azure"></a>Развертывание WebLogic Server в Azure с помощью Шлюза приложений

В этом разделе описано, как использовать Key Vault, SSL-сертификат и пароль, созданные в предыдущих разделах.  Вы подготовите кластер WLS с автоматически созданным Шлюзом приложений Azure в качестве подсистемы балансировки нагрузки для узлов кластера.  Шлюз приложений будет использовать предоставленный SSL-сертификат для завершения SSL-запросов.  Дополнительные сведения см. в статье [Обзор завершения сеансов TLS и использования сквозного режима TLS в Шлюзе приложений](/azure/application-gateway/ssl-overview).

Чтобы создать кластер WLS и Шлюз приложений, выполните приведенные ниже действия.

1. Подготовьте кластер WebLogic Server к работе по инструкциям из [документации по Oracle](https://aka.ms/arm-oraclelinux-wls-cluster-oracle-docs), используя [предложение для кластера WebLogic Server на портале Azure](https://portal.azure.com/#create/oracle.20191007-arm-oraclelinux-wls-cluster20191007-arm-oraclelinux-wls-cluster), но вернитесь на эту страницу, когда дойдете до колонки **Azure Application Gateway** (Шлюз приложений Azure), показанной здесь.

   :::image type="content" source="media/migrate-weblogic-with-app-gateway/weblogic-app-gateway-blade.png" alt-text="Схема, на которой показана связь между WLS, Шлюзом приложений и Key Vault.":::

1. В колонке **Azure Application Gateway** (Шлюз приложений Azure) выберите **Да**.
1. В разделе **Resource group name in current subscription containing the KeyVault** (Имя группы ресурсов в текущей подписке, содержащей KeyVault) введите имя ранее созданной группы ресурсов, содержащей Key Vault.
1. В разделе **Name of the Azure KeyVault containing secrets for the Certificate for SSL Termination** (Имя Azure KeyVault с секретами для сертификата для завершения SSL) введите имя Key Vault.
1. В разделе **The name of the secret in the specified KeyVault whose value is the SSL Certificate Data** (Имя секрета в указанном KeyVault, значение которого является данными SSL-сертификата) введите `myCertSecretData` или любое имя, указанное ранее.
1. В разделе **The name of the secret in the specified KeyVault whose value is the password for the SSL Certificate** (Имя секрета в указанном KeyVault, значение которого является паролем SSL-сертификата) введите `myCertSecretData` или любое имя, указанное ранее.
1. Выберите **Review + Create** (Просмотреть и создать).
1. Нажмите кнопку **создания**.  Это приведет к проверке, можно ли получить сертификат из Key Vault и совпадает ли его пароль со значением, сохраненным для пароля в Key Vault.  Если этот шаг проверки завершился неудачей, проверьте свойства Key Vault и убедитесь, что сертификат и пароль введены правильно.
1. Когда увидите оповещение **Проверка пройдена**, щелкните **Создать**.

Это приведет к запуску процесса создания кластера WLS и его интерфейсного Шлюза приложений, что может занять около 15 минут.  После завершения развертывания выберите **Перейти к группе ресурсов**. В списке ресурсов группы ресурсов выберите **myAppGateway**.

## <a name="validate-successful-deployment-of-wls-and-app-gateway"></a>Проверка успешного развертывания WLS и Шлюза приложений

В этом разделе описана методика быстрой проверки успешного развертывания кластера WLS и Шлюза приложений.

Если вы выбрали **Перейти к группе ресурсов**, а затем **myAppGateway** в конце предыдущего раздела, вы увидите страницу обзора для Шлюза приложений.  Если этого не произошло, эту страницу можно найти, введя `myAppGateway` в текстовом поле в верхней части портала Azure и выбрав нужное в результатах.  Выберите нужную группу ресурсов, созданную для кластера WLS.  Затем сделайте следующее.

1. В левой области страницы обзора для ресурса **myAppGateway** прокрутите вниз до раздела **Наблюдение** и выберите **Оценка работоспособности серверной части**.
1. После того как сообщение **загрузки** исчезнет, в центре экрана появится таблица с узлами вашего кластера, настроенными как узлы в серверном пуле.
1. Убедитесь, что в поле состояния отображается **Работоспособно** для каждого узла.

## <a name="clean-up-resources"></a>Очистка ресурсов

Если вы не собираетесь использовать кластер WLS в дальнейшем, удалите Key Vault и кластер WLS, выполнив приведенные ниже действия.

1. Посетите страницу обзора **myAppGateway**, как показано в предыдущем разделе.
1. В верхней части страницы под текстом **Группа ресурсов** выберите группу ресурсов.
1. Выберите **Удалить группу ресурсов**.
1. Фокус ввода установится в поле с меткой **TYPE THE RESOURCE GROUP NAME** (ВВЕДИТЕ ИМЯ ГРУППЫ РЕСУРСОВ).  Введите соответствующее имя группы ресурсов.
1. После этого кнопка **Удалить** станет доступной.  Нажмите кнопку **Удалить**.  Эта операция займет некоторое время, но вы можете перейти к следующему шагу во время удаления.
1. Найдите Key Vault, выполнив первый шаг из раздела [Сохранение SSL-сертификата в Key Vault]().
1. Выберите команду **Удалить**.
1. В появившейся области выберите **Удалить**.

## <a name="next-steps"></a>Дальнейшие действия

Продолжайте изучать параметры для запуска WLS в Azure.
> [!div class="nextstepaction"]
> [Что представляет собой Oracle WebLogic Server в Azure?](/azure/virtual-machines/workloads/oracle/oracle-weblogic)
