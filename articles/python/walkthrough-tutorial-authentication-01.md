---
title: Пошаговое руководство. Аутентификация приложений Python в службах Azure
description: В этом подробном пошаговом руководстве показано, как с помощью библиотеки удостоверений пакета SDK Azure для Python выполнить аутентификацию приложения Python в таких службах, как Azure Active Directory, Azure Key Vault и Хранилище очередей Azure.
ms.date: 08/24/2020
ms.topic: conceptual
ms.custom: devx-track-python
ms.openlocfilehash: 7f716f3276c0b93ec37ba0941f4029b2ee817fa0
ms.sourcegitcommit: 324da872a9dfd4c55b34739824fc6a6598f2ae12
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 09/02/2020
ms.locfileid: "89379585"
---
# <a name="walkthrough-integrated-authentication-for-python-apps-with-azure-services"></a>Пошаговое руководство. Встроенная аутентификация приложений Python в службах Azure

Azure Active Directory (Azure AD) и Azure Key Vault предлагают универсальные и удобные средства для аутентификации приложений в службах Azure и сторонних поставщиков, в которых используются ключи доступа.

В этом пошаговом руководстве изложены некоторые теоретические основы и показана работа этих средств на примере приложения, доступного в репозитории по адресу [github.com/Azure-Samples/python-integrated-authentication](https://github.com/Azure-Samples/python-integrated-authentication).

Для удобства пример уже развернут в Azure, чтобы вы могли проверить его работу. Если вы хотите развернуть пример в своей подписке Azure, в репозитории вы найдете скрипты развертывания Azure CLI.

## <a name="part-1-background"></a>Часть 1. Историческая справка

Хотя во многих службах Azure авторизация выполняется исключительно с помощью управления доступом на основе ролей, в определенных службах доступ к их ресурсам контролируется с помощью секретов или ключей. К таким службам относятся служба хранилища Azure, базы данных, Cognitive Services, Key Vault и Центры событий.

При создании облачного приложения, использующего ресурсы в этих службах, вам нужно с помощью портала Azure, Azure CLI или Azure PowerShell создать и настроить ключи для приложения, связанные с определенными политиками доступа. Эти ключи предотвращают доступ неавторизованного кода к ресурсам приложения.

В рамках этой общей схемы облачные приложения обычно должны управлять такими ключами и проходить аутентификацию отдельно в каждой службе. Это может оказаться трудоемким процессом, который часто сопровождается ошибками. Кроме того, управление ключами непосредственно в коде приложения связано с риском их раскрытия в системе управления версиями, а сами ключи могут храниться на незащищенных рабочих станциях разработчиков.

К счастью, в Azure есть две специальные службы, которые упрощают этот процесс и обеспечивают лучшую защиту:

- Azure Key Vault предлагает безопасное облачное хранилище для ключей доступа (а также криптографических ключей и сертификатов, которые здесь не рассматриваются). При использовании Key Vault приложение обращается к таким ключам только во время выполнения, поэтому они никогда не появляются непосредственно в исходном коде.

- Управляемые удостоверения службы Azure Active Directory (Azure AD) позволяют приложению проходить аутентификацию только один раз в самой этой службе. После этого выполняется автоматическая аутентификация приложения в других службах Azure, включая Key Vault. Это устраняет необходимость реализовать в коде механизмы управления ключами или другими учетными данными для этих служб Azure. Более того, вы можете выполнять один и тот же код как локально, так и в облаке с минимальными требованиями к конфигурации.

При использовании Azure AD с Key Vault вам не придется выполнять аутентификацию приложения в отдельных службах Azure, а доступ к ключам, необходимым для сторонних служб, будет удобным и безопасным.

> [!IMPORTANT]
> В этом руководстве используется общий универсальный термин "ключ" для обозначения того, что хранится в Azure Key Vault в виде "секрета", например ключ доступа для REST API. Это понятие не следует путать с функцией Key Vault для управления *криптографическими* ключами, которая никак не связана с *секретами*.

## <a name="example-cloud-app-scenario"></a>Сценарий для примера облачного приложения

Чтобы лучше понять процесс аутентификации в Azure, рассмотрим следующий сценарий:

- Основное приложение предоставляет общедоступную конечную точку API (не требующую аутентификации), которая в ответ на HTTP-запросы возвращает данные в формате JSON. Пример конечной точки реализован в виде простого приложения Flask, развернутого в Службе приложений Azure.

- Чтобы создать ответ, API вызывает сторонний API, для которого требуется ключ доступа. Приложение извлекает этот ключ доступа из Azure Key Vault во время выполнения.

- Перед возвращением ответа API записывает сообщение в очередь службы хранилища Azure для последующей обработки (процесс обработки этих сообщений не касается основного сценария).

![Схема сценария для приложения](media/walkthrough-tutorial-authentication/scenario-diagram.png)

> [!NOTE]
> Хотя общедоступная конечная точка API обычно защищена собственным ключом доступа, в этом руководстве предполагается, что она открыта и не требует проверки подлинности. Это предположение позволяет избежать путаницы между потребностями в аутентификации приложения и *внешней* вызывающей стороны этой конечной точки. В этом сценарии аутентификация внешней вызывающей стороны не предусмотрена.

> [!div class="nextstepaction"]
> [Часть 2. Требования к аутентификации >>>](walkthrough-tutorial-authentication-02.md)
