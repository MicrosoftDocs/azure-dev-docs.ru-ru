---
title: Настройка локальной среды Python для разработки в Azure
description: Сведения о настройке локальной среды разработки Python для работы с Azure, включая Visual Studio Code, библиотеки Azure SDK и необходимые учетные данные для проверки подлинности библиотеки.
ms.date: 05/29/2020
ms.topic: conceptual
ms.custom: devx-track-python, devx-track-azurecli
ms.openlocfilehash: b9e3c36199cfe9fa94fa518587b6065f4d9ef9b0
ms.sourcegitcommit: 12f80b1e0fe08db707c198271d0c399c3aba343a
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/11/2020
ms.locfileid: "94515155"
---
# <a name="configure-your-local-python-dev-environment-for-azure"></a>Настройка локальной среды разработки Python для Azure

При создании облачных приложений разработчики обычно предпочитают тестировать код на локальных рабочих станциях до его развертывания в облачной среде, такой как Azure. Локальная разработка предоставляет преимущество в скорости и более широкий спектр средств отладки.

В этой статье приведены инструкции по однократной настройке для создания и проверки локальной среды разработки, которая подходит для Python в Azure.

- [Установите обязательные компоненты](#required-components), а именно: учетную запись Azure, Python и Azure CLI.
- [Настройте проверку подлинности](#configure-authentication) для использования библиотек Azure, чтобы подготовить к работе ресурсы Azure, управлять ими и получить к ним доступ.
- Ознакомьтесь с процессом [использования виртуальных окружений Python](#use-python-virtual-environments) для каждого проекта.

После настройки рабочей станции вам потребуется внести небольшие коррективы в конфигурацию для выполнения инструкций в различных кратких руководствах и других учебниках где-либо еще в этом центре разработчиков и в документации Azure.

Не путайте такую настройку для локальной разработки с [подготовкой ресурсов](cloud-development-flow.md), которые формируют *облачную среду* вашего приложения в Azure. В процессе разработки вы выполняете код в локальной среде разработки, которая может обращаться к таким облачным ресурсам, но ваш код еще не развернут в [подходящей службе размещения](quickstarts-app-hosting.md) в облаке. Этот шаг развертывания выполняется позже, как описано в статье [Поток разработки Azure](cloud-development-flow.md).

## <a name="install-components"></a>Установка компонентов

### <a name="required-components"></a>Необходимые компоненты

| Имя или установщик | Описание |
| --- | --- |
| [Учетная запись Azure с активной подпиской](https://azure.microsoft.com/free/?utm_source=campaign&utm_campaign=python-dev-center&mktingSource=environment-setup) | Учетные записи или подписки являются бесплатными и содержат множество бесплатных служб. |
| [Python 2.7+ или 3.5.3+](https://www.python.org/downloads) | Языковая среда выполнения Python. Мы рекомендуем использовать последнюю версию Python 3.x, если нет особых требований к версии. |
| [Интерфейс командной строки Azure (CLI)](/cli/azure/install-azure-cli) | Предоставляет полный набор команд CLI для подготовки к работе ресурсов Azure и управления ими. Разработчики Python обычно используют Azure CLI в сочетании с пользовательскими скриптами Python, которые используют библиотеки управления Azure. |

Примечания.

- В зависимости от потребностей вы можете установить отдельные библиотеки Azure для каждого проекта. Мы рекомендуем [использовать виртуальные окружения Python](#use-python-virtual-environments) для каждого проекта. Автономного установщика "SDK" для Python не существует.
- Хотя Azure PowerShell и Azure CLI в целом эквивалентны, рекомендуется использовать Azure CLI при работе с Python.

### <a name="recommended-components"></a>Рекомендуемые компоненты

| Имя или установщик | Описание |
| --- | --- |
| [Visual Studio Code](https://code.visualstudio.com) | Хотя вы можете работать с любым подходящим редактором или интегрированной средой разработки (IDE), бесплатная, упрощенная IDE от корпорации Майкрософт очень популярна среди разработчиков Python. Общие сведения см. в статье [Python в VS Code](https://code.visualstudio.com/docs/python/python-tutorial). |
| [Расширение Python для VS Code](https://marketplace.visualstudio.com/items?itemName=ms-python.python) | Добавляет поддержку Python в VS Code. |
| [Расширение Azure для VS Code](https://marketplace.visualstudio.com/items?itemName=ms-vscode.vscode-node-azure-pack) | Добавляет поддержку различных служб Azure для VS Code. Поддержку конкретных служб также можно установить по отдельности. |
| [git](https://git-scm.com/downloads) | Средства командной строки для системы управления версиями. При желании можно использовать другие средства системы управления версиями. |

### <a name="optional-components"></a>Дополнительные компоненты

| Имя или установщик | Описание |
| --- | --- |
| [Расширение Docker для VS Code](https://marketplace.visualstudio.com/items?itemName=ms-python.python) | Добавляет поддержку Docker в VS Code, что полезно при регулярной работе с контейнерами. |

### <a name="verify-components"></a>Проверка компонентов

1. Откройте терминал или командную строку.
1. Определите версию Python, выполнив команду `python --version`.
1. Определите версию Azure CLI, выполнив команду `az --version`.
1. Проверьте установку VS Code:
    1. Запустите `code .`, чтобы открыть VS Code в текущей папке.
    1. В VS Code выберите команду **Просмотреть** > **Расширения** , чтобы открыть представление расширений, а затем убедитесь, что в списке отображаются Python и "Учетная запись Azure" (помимо других расширений Azure и Docker, если вы их также установили).

## <a name="sign-in-to-azure-from-the-cli"></a>Вход в Azure с помощью интерфейса командной строки

Войдите в подписку Azure с помощью терминала или командной строки:

```azurecli
az login
```

Команда `az` является корневой командой Azure CLI. После `az` следует одна или несколько специальных команд, например `login`. См. справочник по командам [az login](/cli/azure/authenticate-azure-cli).

Azure CLI обычно поддерживает вход в разные сеансы, но мы рекомендуем запускать `az login` при каждом открытии нового терминала или командной строки.

## <a name="configure-authentication"></a>Настройка аутентификации

Как описано в разделе [Как аутентифицировать и авторизовать приложения Python в Azure](azure-sdk-authenticate.md#identity-when-running-the-app-locally), каждому разработчику требуется субъект-служба, чтобы использовать его в качестве удостоверения приложения при локальном тестировании кода приложения.

В следующих разделах описывается создание субъекта-службы и переменных среды, которые предоставляют свойства субъекта-службы для библиотек Azure по мере необходимости.

Каждый разработчик в организации должен выполнить эти шаги индивидуально.

### <a name="create-a-service-principal-and-environment-variables-for-development"></a>Создание субъекта-службы и переменных среды для разработки

1. Откройте терминал или командную строку, с помощью которой вы вошли в Azure CLI (`az login`).

1. Создайте субъект-службу, выполнив следующую команду:

    ```azurecli
    az ad sp create-for-rbac --name localtest-sp-rbac --skip-assignment --sdk-auth > local-sp.json
    ```

    Эта команда сохраняет выходные данные в файле *local-sp.json*. Дополнительные сведения об этой команде и ее аргументах см. в разделе [Что делает команда create-for-rbac](#what-the-create-for-rbac-command-does).

    Если вы находитесь в организации, то, возможно, у вас в подписке нет разрешения на выполнение этой команды. В этом случае обратитесь к владельцам подписки, чтобы они создали субъект-службу.

1. Создайте переменные среды, необходимые библиотекам Azure, выполнив приведенные ниже команды. (Объект `DefaultAzureCredential` библиотеки azure-identity ищет эти переменные.)

    # <a name="cmd"></a>[cmd](#tab/cmd)

    ```cmd
    set AZURE_SUBSCRIPTION_ID="aa11bb33-cc77-dd88-ee99-0918273645aa"
    set AZURE_TENANT_ID=00112233-7777-8888-9999-aabbccddeeff
    set AZURE_CLIENT_ID=12345678-1111-2222-3333-1234567890ab
    set AZURE_CLIENT_SECRET=abcdef00-4444-5555-6666-1234567890ab
    ```

    # <a name="bash"></a>[bash](#tab/bash)

    ```bash
    AZURE_SUBSCRIPTION_ID="aa11bb33-cc77-dd88-ee99-0918273645aa"
    AZURE_TENANT_ID="00112233-7777-8888-9999-aabbccddeeff"
    AZURE_CLIENT_ID="12345678-1111-2222-3333-1234567890ab"
    AZURE_CLIENT_SECRET="abcdef00-4444-5555-6666-1234567890ab"
    ```

    ---

    Замените приведенные в этих командах значения теми, которые относятся к конкретной субъект-службе.

    Чтобы получить идентификатор подписки, выполните команду [`az account show`](/cli/azure/account#az-account-show) и найдите свойство `id` в выходных данных.

    Для удобства создайте файл сценария командной строки (например, *setenv.sh* (macOS или Linux) или *setenv.cmd* (Windows)), который содержит эти же команды. Затем можно будет запускать этот сценарий, чтобы задать переменные, при каждом открытии терминала или командной строки для локального тестирования. Опять же, не добавляйте этот файл сценария в систему управления версиями, чтобы он хранился только в пределах вашей учетной записи пользователя.

1. Защитите идентификатор и секрет клиента (и все файлы, в которых они хранятся), чтобы они всегда оставались в пределах определенной учетной записи пользователя на рабочей станции. Никогда не сохраняйте эти свойства в системе управления версиями и не делитесь ими с другими разработчиками. При необходимости можно удалить субъект-службу и создать заново.

    Для дополнительного уровня безопасности можно создать политику, чтобы удалять и повторно создавать субъекты-службы по расписанию, что делает предыдущие идентификаторы и секреты недействительными.

    Кроме того, в идеале разрешать субъект-службу разработки только для нерабочих ресурсов или создавать в рамках подписки Azure, которая используется только для разработки. Рабочее приложение будет использовать отдельную подписку и отдельные рабочие ресурсы, которые разрешены только для развернутого облачного приложения.

1. Чтобы позже изменить или удалить субъекты-службы, ознакомьтесь со статьей [Управление субъектами-службами](how-to-manage-service-principals.md).

#### <a name="what-the-create-for-rbac-command-does"></a>Что делает команда create-for-rbac

Команда `az ad create-for-rbac` создает субъект-службу для проверки подлинности на основе ролей (RBAC).

- `ad` означает Azure Active Directory; `sp` означает "субъект-служба", а `create-for-rbac` означает "создать для управления доступом на основе ролей" (основная форма авторизации Azure). См. справочник по командам [az ad sp create-for-rbac](/cli/azure/ad/sp#az-ad-sp-create-for-rbac).

- Аргумент `--name` должен быть уникальным в пределах организации и обычно использует имя разработчика, использующего субъект-службу. Если опустить этот аргумент, Azure CLI использует универсальное имя формы `azure-cli-<timestamp>`. При необходимости можно переименовать субъект-службу на портале Azure.

- Аргумент `--skip-assignment` создает субъект-службу без разрешений по умолчанию. Затем необходимо назначить особые разрешения субъекту-службе, чтобы разрешить локальное выполнение кода для доступа к любым ресурсам. В разных кратких руководствах и учебниках содержатся сведения об авторизации субъекта-службы для задействованных ресурсов.

- Команда предоставляет выходные данные JSON, которые в данном примере сохраняются в файле *local-sp.json*.

- Аргумент `--sdk-auth` создает выходные данные JSON, аналогичные следующим значениям. Ваши значения идентификатора и секрет будут отличаться:

    <pre>
    {
      "clientId": "12345678-1111-2222-3333-1234567890ab",
      "clientSecret": "abcdef00-4444-5555-6666-1234567890ab",
      "subscriptionId": "00000000-0000-0000-0000-000000000000",
      "tenantId": "00112233-7777-8888-9999-aabbccddeeff",
      "activeDirectoryEndpointUrl": "https://login.microsoftonline.com",
      "resourceManagerEndpointUrl": "https://management.azure.com/",
      "activeDirectoryGraphResourceId": "https://graph.windows.net/",
      "sqlManagementEndpointUrl": "https://management.core.windows.net:8443/",
      "galleryEndpointUrl": "https://gallery.azure.com/",
      "managementEndpointUrl": "https://management.core.windows.net/"
    }
    </pre>

    Без аргумента `--sdk-auth` команда создает более простые выходные данные:

    <pre>
    {
      "appId": "12345678-1111-2222-3333-1234567890ab",
      "displayName": "localtest-sp-rbac",
      "name": "http://localtest-sp-rbac",
      "password": "abcdef00-4444-5555-6666-1234567890ab",
      "tenant": "00112233-7777-8888-9999-aabbccddeeff"
    }
    </pre>

    В этом случае `tenant` является идентификатором арендатора, `appId` — идентификатором клиента, а `password` — секретом клиента.

    > [!IMPORTANT]
    > Выходные данные от этой команды являются единственным расположением, в котором можно всегда увидеть секрет или пароль клиента. Вы не сможете позже получить секрет или пароль. Однако при необходимости можно добавить новый секрет, не аннулируя субъект-службу или существующие секреты.

## <a name="use-python-virtual-environments"></a>Использование виртуальных окружений Python

Для каждого проекта рекомендуется всегда создавать и активировать *виртуальное окружение* , выполняя указанные ниже действия.

1. Откройте терминал или командную строку.

1. Создайте каталог для своего проекта.

1. Создайте виртуальное окружение, выполнив следующую команду:

    # <a name="cmd"></a>[cmd](#tab/cmd)

    ```bash
    # py -3 uses the global python interpreter. You can also use python -m venv .venv.
    py -3 -m venv .venv
    ```

    # <a name="bash"></a>[bash](#tab/bash)

    ```bash
    # On Windows, use py -3 -m venv .venv
    python3 -m venv .venv
    ```

    ---

    Эта команда запускает модуль `venv` для Python и создает виртуальное окружение в папке `.venv`.

1. Активируйте виртуальное окружение, выполнив следующую команду:

    # <a name="cmd"></a>[cmd](#tab/cmd)

    ```cmd
    .venv\scripts\activate
    ```

    # <a name="bash"></a>[bash](#tab/bash)

    ```bash
    source .venv/bin/activate
    ```

    ---

Виртуальное окружение — это папка в проекте, которая изолирует копию конкретного интерпретатора Python. После активации этого окружения (которое в Visual Studio Code выполняется автоматически) при запуске `pip install` только в этом окружении устанавливается библиотека. Затем при выполнении кода Python он выполняется в точном контексте окружения с конкретными версиями каждой библиотеки. При запуске `pip freeze` вы получаете точный список этих библиотек. (Во многих примерах в этой документации вы создаете файл *requirements.txt* для нужных библиотек, а затем используете `pip install -r requirements.txt`. Файл требований обычно необходим при развертывании кода в Azure.)

Если виртуальное окружение не используется, то Python выполняется в собственной *глобальной среде*. Несмотря на то, что использование глобальной среды является быстрым и удобным, эта среда, как правило, увеличивается со временем за счет всех библиотек, которые устанавливаются для любого проекта или эксперимента. Кроме того, при обновлении библиотеки для одного проекта могут быть нарушены другие проекты, зависящие от разных версий этой библиотеки. Так как среда является общей для любого количества проектов, нельзя использовать `pip freeze` для получения списка зависимостей какого-то одного проекта.

Глобальная среда — это расположение, в котором необходимо установить пакеты средств, которые необходимо использовать в нескольких проектах. Например, вы можете запустить `pip install gunicorn` в глобальной среде, чтобы веб-сервер Gunicorn был доступным повсеместно.

## <a name="use-source-control"></a>Использование системы управления версиями

Мы рекомендуем всегда создавать репозиторий системы управления версиями при каждом запуске проекта. Если установлен Git, просто выполните следующую команду:

```cmd
git init
```

Здесь можно выполнять такие команды, как `git add` и `git commit`, чтобы фиксировать изменения. Регулярно фиксируя изменения, вы создаете журнал фиксаций, с помощью которого можно вернуться к любому предыдущему состоянию.

Чтобы выполнить оперативное резервное копирование проекта, мы также рекомендуем отправить репозиторий в [GitHub](https://github.com) или [Azure DevOps](/azure/devops/user-guide/code-with-git?view=azure-devops&preserve-view=true). Если сначала вы инициализируете локальный репозиторий, используйте `git remote add`, чтобы подключить локальный репозиторий к GitHub или Azure DevOps.

Документацию по Git можно найти по адресу [git-scm.com/docs](https://git-scm.com/docs) и в Интернете.

Visual Studio Code включает ряд встроенных функций Git. Дополнительные сведения в см. в статье [Использование системы управления версиями в VS Code](https://code.visualstudio.com/docs/editor/versioncontrol).

Вы также можете использовать любую другую систему управления версиями по своему усмотрению. Git — это просто одна из самых широко используемых и поддерживаемых систем.

## <a name="next-step"></a>Следующий шаг

Используя локальную среду разработки, кратко рассмотрим распространенные схемы использования библиотек Azure:

> [!div class="nextstepaction"]
> [Ознакомьтесь с распространенными схемами использования >>>](azure-sdk-library-usage-patterns.md)
