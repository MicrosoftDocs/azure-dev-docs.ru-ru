---
title: include file create-storage-resource.md
description: include file create-storage-resource.md
ms.date: 10/13/2020
ms.topic: include
ms.custom: devx-track-javascript
ms.openlocfilehash: 6862d9cf56ee86f7137495b021144b518459d979
ms.sourcegitcommit: 1ddcb0f24d2ae3d1f813ec0f4369865a1c6ef322
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/27/2020
ms.locfileid: "92756004"
---
В этом разделе руководства показано, как создать ресурс службы хранилища Azure с расширением Visual Studio, а затем настроить этот ресурс на портале Azure. 

## <a name="sign-in-to-azure"></a>Вход в Azure

[!INCLUDE [azure-sign-in](azure-sign-in.md)]

## <a name="create-storage-resource"></a>Создание ресурса службы хранилища 

Используйте расширение Visual Studio Code, чтобы создать ресурс службы хранилища. 

1. Перейдите к расширению службы хранилища Azure. Щелкните подписку правой кнопкой мыши и выберите действие `Create Storage Account...`.

    :::image type="content" source="../../media/tutorial-browser-file-upload/visualstudiocode-storage-extension-create-resource.png" alt-text="Перейдите к расширению службы хранилища Azure. Щелкните правой кнопкой мыши подписку и выберите команду &quot;Создание учетной записи хранения...&quot;.":::

1. Выполните инструкции из следующей таблицы, чтобы разобраться в применении значений разных свойств.

    |Свойство|Значение|
    |--|--|
    |Введите глобально уникальное имя для нового веб-приложения.| Введите значение для ресурса службы хранилища, например `fileuploadyourname`. Замените строку `yourname` именем или уникальным идентификатором в нижнем регистре. Это уникальное имя также добавляется в URL-адрес для доступа к этому ресурсу в браузере. Используйте только буквы и цифры, не более 24 символов. Это **имя учетной записи** потребуется в дальнейшем.|

1. Когда завершится процесс создания приложения, появится уведомление со сведениями о новом ресурсе. 

    :::image type="content" source="../../media/tutorial-browser-file-upload/visualstudiocode-storage-extension-create-resource-complete.png" alt-text="Перейдите к расширению службы хранилища Azure. Щелкните правой кнопкой мыши подписку и выберите команду &quot;Создание учетной записи хранения...&quot;.":::

## <a name="set-storage-account-name-in-code-file"></a>Задание имени учетной записи хранения в файле кода

В файле `src/uploadToBlob.ts` присвойте имя ресурса параметру `storageAccountName`, добавив имя ключа к хранилищу данных в пустую строку. Сохраните остальную часть кода неизменной. 

```typescript
const storageAccountName = process.env.storageresourcename || ""; 
```

## <a name="generate-your-shared-access-signature-sas-token"></a>Создание маркера подписанного URL-адреса (SAS) 

Прежде чем настраивать CORS, нужно создать маркер SAS. 

1. В расширении службы хранилища для Visual Studio Code щелкните ресурс правой кнопкой мыши и выберите **Открыть на портале** . Откроется страница этого ресурса службы хранилища на портале Azure.
1. В разделе **Параметры** выберите элемент **Подписанный URL-адрес** . 
1. Настройте для маркера SAS следующие параметры. 

    | Свойство|Значение|
    |--|--|
    |Разрешенные службы|BLOB-объект|
    |Допустимые типы ресурсов|Служба, контейнер, объект|
    |Допустимые разрешения|Чтение, запись, удаление, перечисление, добавление, создание|
    |Возможность удаления версий|Флажок установлен|
    |Дата и время начала и окончания срока действия|Подтвердите дату и время начала действия, а дату и время окончания установите на сутки вперед. Этот маркер SAS будет действителен только в течение 24 часов.|
    |Только HTTPS|Выбрано|
    |Предпочтительный уровень маршрутизации|Basic|
    |Ключ подписывания|Выбран key1|

    :::image type="content" source="../../media/tutorial-browser-file-upload/azure-portal-storage-blob-generate-sas-token.png" alt-text="Перейдите к расширению службы хранилища Azure. Щелкните правой кнопкой мыши подписку и выберите команду &quot;Создание учетной записи хранения...&quot;.":::

1.  Выберите действие **Создать SAS и строку подключения** . Сразу же скопируйте маркер SAS. Вы не сможете получить этот маркер позднее. Если не скопировать его сейчас, придется создавать новый маркер SAS. 

## <a name="set-sas-token-in-code-file"></a>Настройка маркера SAS в файле кода

Значение маркера SAS является частью строки запроса и добавляется в URL-адрес при обращении к облачному ресурсу.

Формат этого маркера зависит от того, какой инструмент вы использовали для его создания: 
* **Портал Azure** : Если маркер SAS создается на портале, первым символом строки маркера будет `?`.
* **Azure CLI.** Если маркер SAS создается с помощью Azure CLI, возвращаемое значение не будет содержать `?` в качестве первого символа строки маркера. 

1. Удалите `?`, если это первый символ маркера. Файл кода подставляет `?` автоматически, поэтому его не нужно включать в маркер.

1. В файле `src/uploadToBlob.ts` присвойте маркер SAS в качестве значения параметра sasToken, добавив маркер SAS в пустую строку. Сохраните остальную часть кода неизменной. 

```typescript
// remove `?` if it is first character of token
const sasToken = process.env.storagesastoken || "";
```

## <a name="configure-your-azure-storage-resource-for-cors-with-azure-cli"></a>Настройка CORS для ресурса службы хранилища Azure с помощью Azure CLI

Настройте CORS для созданного ресурса, чтобы код React на стороне клиента мог получить доступ к этой учетной записи хранения. 

1. В том же окне портала Azure откройте раздел **Параметры** и выберите **CORS** . 
1. Настройте CORS, как показано на изображении. Эти параметры объясняются под изображением. 

    | Свойство|Значение|
    |--|--|
    |Разрешенные источники|`*`|
    |Допустимые методы|Все, кроме исправлений.|
    |Допустимые заголовки|`*`|
    |Предоставляемые заголовки|`*`|
    |Максимальный возраст|86400|

    :::image type="content" source="../../media/tutorial-browser-file-upload/azure-portal-storage-blob-cors.png" alt-text="Перейдите к расширению службы хранилища Azure. Щелкните правой кнопкой мыши подписку и выберите команду &quot;Создание учетной записи хранения...&quot;.":::

1. Щелкните **Сохранить** над разделом с параметрами, чтобы сохранить их для ресурса. Для работы с этими параметрами CORS никакие изменения в коде не требуются. 

## <a name="run-project-locally-to-verify-connection-to-storage-account"></a>Запуск проекта в локальной среде для проверки подключения к учетной записи хранения

Итак, маркер SAS и имя учетной записи хранения настроены в файле `src/uploadToBlob.ts`, и теперь все готово к запуску приложения.

1. В терминале Visual Studio Code введите следующую команду:

    ```javascript
    npm start
    ```

1. Когда в окне терминала отобразится URL-адрес (например `http://localhost:3000`), значит приложение готово к работе. Откройте любой браузер и введите в адресной строке этот URL-адрес. Должен открыться веб-сайт, подключенный к хранилищу больших двоичных объектов Azure, с кнопками для выбора и отправки файла. 

    :::image type="content" source="../../media/tutorial-browser-file-upload/browser-react-app-azure-storage-resource-configured-upload-button-displayed.png" alt-text="Перейдите к расширению службы хранилища Azure. Щелкните правой кнопкой мыши подписку и выберите команду &quot;Создание учетной записи хранения...&quot;.":::

1. Выберите для отправки изображение из папки `images`. Для этого теста хорошо подойдет визуальный объект `spring-flowers.jpg`. Нажмите кнопку **Upload!** (Отправить). . 

    Клиентский код интерфейса React вызывает `src/uploadToBlob.ts` для проверки подлинности в Azure, а затем создает контейнер службы хранилища (если он еще не существует) и отправляет в него большой двоичный объект. 

## <a name="want-to-know-more"></a>Хотите получить дополнительные сведения? 

Ниже приведены другие способы, позволяющие настроить учетную запись хранения.
* Маркер SAS с помощью [PowerShell](/powershell/module/azure.storage/new-azurestorageblobsastoken)
* Маркер SAS с помощью портала
* CORS с помощью [PowerShell](/powershell/module/azure.storage/set-azurestoragecorsrule)
* CORS с помощью портала

Узнайте больше о [подписанных URL-адресах](/azure/storage/common/storage-sas-overview).
