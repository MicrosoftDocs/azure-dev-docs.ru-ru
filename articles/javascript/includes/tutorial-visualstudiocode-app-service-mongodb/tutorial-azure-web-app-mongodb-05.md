---
title: include file tutorial-azure-web-app-mongodb-05.md
description: include file tutorial-azure-web-app-mongodb-05.md
ms.date: 10/13/2020
ms.topic: include
ms.custom: devx-track-javascript
ms.openlocfilehash: 9b8a718ec921050237f911ee4b5c3a47b6bbb45e
ms.sourcegitcommit: 8a2a7df568c69fff2080ffab248409040efda1ac
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/19/2020
ms.locfileid: "92183937"
---
В этом разделе руководства показано, как создать облачную базу данных и подключить к ней удаленное приложение. 

## <a name="create-a-cosmos-database"></a>Создание базы данных Cosmos

Создайте ресурс Cosmos для размещения облачной базы данных MongoDB. 

1. В Visual Studio Code щелкните значок **Azure** в крайнем левом меню, а затем выберите раздел **Базы данных** . 

    Если раздел **Базы данных** не отображается, убедитесь, что в верхнем меню Azure **...** выбран этот раздел. 

    :::image type="content" source="../../media/tutorial-end-to-end-app-cosmos/vscode-azure-extension-select-database-section.png" alt-text="Снимок части экрана, на котором показан значок удаленного контейнера в Visual Studio Code"::: 

1. В разделе **Базы данных** в обозревателе Azure щелкните подписку правой кнопкой мыши, а затем выберите пункт **Создать сервер** .
1. В палитре команд в разделе **Create new Azure Database Server** (Создать новый сервер Базы данных Azure) выберите **Azure Cosmos DB for MongoDB API** (Azure Cosmos DB для API MongoDB). 
1. Выполните инструкции из следующей таблицы, чтобы разобраться в применении значений разных свойств. На создание базы данных может потребоваться до 15 минут.

    |Свойство|Значение|
    |--|--|
    |Введите глобально уникальное **имя учетной записи** для нового ресурса.| Введите значение для ресурса, например `cosmos-mongodb-YOUR-NAME`. Замените строку `YOUR-NAME` именем или уникальным идентификатором. Это уникальное имя также добавляется в URL-адрес для доступа к этому ресурсу в браузере.|
    |Выберите или создайте группу ресурсов.|Если вам нужно создать группу ресурсов, примените соглашение об именовании с указанием владельца, назначения и региона, например `westus-cosmostutorial-joesmith`.|
    |Расположение|Расположение ресурса. Для работы с этим руководством выберите ближайший к вам регион.|

    > [!CAUTION]
    > Создание ресурса может занять до 15 минут.     

1. Просмотрите только что созданный ресурс Cosmos в обозревателе. У него пока нет баз данных. 
1. В том же окне обозревателя баз данных Azure щелкните имя ресурса правой кнопкой мыши, и выберите **Копирование строки подключения** , чтобы скопировать строку подключения. Она пригодится вам далее в этом руководстве.

    :::image type="content" source="../../media/tutorial-end-to-end-app-cosmos/vscode-databases-extenion-copy-connection-string.png" alt-text="Снимок части экрана, на котором показан значок удаленного контейнера в Visual Studio Code":::

## <a name="optional-use-new-cloud-database-in-local-environment"></a>Необязательно. Использование новой облачной базы данных в локальной среде

Для использования новой облачной базы данных необходимо изменить локальное приложение так, чтобы оно использовало новую строку подключения. 

1. В Visual Studio Code откройте файл `.env` и добавьте в новую строку подключения значение **DATABASE_URL** . 
1. В конец этой строки подключения добавьте `&retrywrites=false`, чтобы база данных была создана автоматически при первом запуске веб-приложения. 
1. Запустите веб-приложение локально, не используя контейнер разработки, и убедитесь, что приложение успешно подключается к облачной базе данных. 

## <a name="use-new-cloud-database-in-remote-web-app"></a>Использование облачной базы данных в удаленном веб-приложении

Подключение к базе данных задается в переменной среды с именем `DATABASE_URL`. Чтобы удаленное веб-приложение использовало эту переменную среды, необходимо создать ее в удаленном веб-приложении. 

1. В Visual Studio Code откройте обозреватель Службы приложений Azure, затем выберите и разверните узел службы веб-приложений.
1.  Щелкните правой кнопкой мыши узел **Параметры приложения** , чтобы добавить свойство `DATABASE_URL` со значением строки подключения к Azure Cosmos DB для MongoDB. В конец этой строки подключения добавьте `&retrywrites=false`, чтобы база данных была создана автоматически при первом запуске веб-приложения. 

    :::image type="content" source="../../media/tutorial-end-to-end-app-cosmos/vscode-remote-web-app-application-settings.png" alt-text="Снимок части экрана, на котором показан значок удаленного контейнера в Visual Studio Code"::: 

1. Откройте удаленный веб-сайт в любом браузере, затем добавьте и удалите данные с помощью предложенной формы. 

## <a name="want-to-know-more"></a>Хотите получить дополнительные сведения? 

### <a name="mongodb-connection-strings"></a>Строки подключения MongoDB
Для создания базы данных при первом запуске кода может потребоваться несколько повторных попыток, поэтому в строку подключения нужно включить параметр `&retrywrites=false`. Если вы хотите изучить эту проблему, обратитесь к общедоступному описанию [проблемы №1296](https://github.com/microsoft/vscode-cosmosdb/issues/1296) на сайте GitHub. 