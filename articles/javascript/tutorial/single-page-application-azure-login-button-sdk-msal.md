---
title: Руководство по добавлению кнопки входа Майкрософт для одностраничного приложения React
description: Проверка подлинности Azure Active Directory, описанная в этом учебнике, выполняется с помощью кнопки входа и выхода, которая предоставляет доступ к учетной записи пользователя (электронной почте). Разработайте приложение TypeScript с помощью клиентского пакета SDK Azure `@azure/msal-browser`, чтобы управлять взаимодействием пользователя в одностраничном приложении (SPA).
ms.topic: tutorial
ms.date: 02/16/2020
ms.custom: devx-track-js, "azure-sdk-javascript-@azure/msal-browser-2.7.0"
ms.history:
- 20210216:fix public issue 443
ms.openlocfilehash: d5d64f1de3637c79a081e64dbf3cd632e15a3ef3
ms.sourcegitcommit: 450cfb580f0fef7aabd38a7db17ecf7502126ce4
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/16/2021
ms.locfileid: "100548845"
---
# <a name="add-microsoft-login-button-to-a-single-page-application-for-authentication"></a>Добавление кнопки входа Майкрософт в одностраничное приложение для выполнения проверки подлинности

Проверка подлинности Azure, описанная в этом руководстве по TypeScript, выполняется с помощью кнопки входа и выхода и предоставляет доступ к учетной записи пользователя. Разработайте приложение с помощью клиентского пакета SDK Azure, `@azure/msal-browser`, чтобы управлять взаимодействием пользователя в одностраничном приложении (SPA).

* [Образец кода](https://github.com/Azure-Samples/js-e2e-client-azure-login-button)

## <a name="application-architecture-and-functionality"></a>Архитектура и функциональные возможности приложения

Одностраничное приложение, созданное с помощью инструкций из этого учебника, представляет собой приложение React (create-react-app), которое позволяет выполнить указанные ниже задачи.

- Вход в систему, поддерживаемый корпорацией Майкрософт, например Office 365 или Outlook.com.
- Выход из приложения.

Чтобы обеспечить быстрое и простое одностраничное приложение, в примере используется средство **create-react-app** с TypeScript. Эта внешняя платформа предоставляет несколько ярлыков, используемых в типичной разработке клиентских приложений, с пакетами SDK Azure:

- Объединение, необходимое для пакетов SDK Azure, используемых в клиентском приложении.
- Переменные среды в файле `.env`.

## <a name="1-set-up-development-environment"></a>1. Настройка среды разработки

Убедитесь, что на локальном компьютере установлено следующее программное обеспечение.

- Учетная запись Azure с активной подпиской. [Создайте бесплатно](https://azure.microsoft.com/free/).
- Установите на локальный компьютер [Node.js и npm](https://nodejs.org/en/download).
- [Visual Studio Code](https://code.visualstudio.com/) или эквивалентная интегрированная среда разработки с оболочкой или терминалом Bash на локальном компьютере. 

## <a name="2-keep-value-for-environment-variable"></a>2. Сохранение значения переменной среды

Определите место для копирования значения идентификатора клиента для регистрации приложения, например текстовый файл. Этот идентификатор клиента понадобится на шаге 5 следующего раздела. Это значение будет использовано в качестве переменной среды для веб-приложения.  

## <a name="3-create-app-registration-for-authentication"></a>3. Создание регистрации приложения для выполнения проверки подлинности

1. **Войдите** на [портал Azure](https://portal.azure.com/?quickstart=True#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/RegisteredApps) для регистрации приложения каталога по умолчанию.
1. Выберите **+ Новая регистрация.**
1. **Введите данные для регистрации приложения**, используя сведения из следующей таблицы:

   | Поле                   | Значение                                                                                                                                                                      |Описание|
   | ----------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |--|
   | Имя                    | `Simple Auth Tutorial`|Это имя приложения, которое пользователь увидит в форме для разрешения при входе в приложение.                                                 |
   | Поддерживаемые типы учетных записей | **Учетные записи в любом каталоге организации (любой каталог Azure AD — мультитенантный) и персональные учетные записи Майкрософт**|Включает большинство типов учетных записей. |
   | Тип URI перенаправления           | **Одностраничное приложение (SPA)**                                                                                        | |
   | Значение URI перенаправления           | `http://localhost:3000` | URL-адрес для возврата после успешного выполнения или сбоя проверки подлинности.                                                                                        |

    :::image type="content" source="../media/tutorial-login-button/azure-active-directory-create-new-app-registration.png" alt-text="Регистрация нового приложения Azure.":::  

1. Выберите **Зарегистрировать**. Дождитесь завершения процесса регистрации приложения.
1. **Скопируйте идентификатор приложения (клиента)** из раздела "Обзор" регистрации приложения. Это значение будет добавлено в переменную среды для клиентского приложения позже.

## <a name="4-create-react-single-page-application-for-typescript"></a>4. Создание одностраничного приложения React для TypeScript

1. В оболочке Bash **создайте create-react-app**, используя TypeScript в качестве языка:

   ```bash
   npx create-react-app tutorial-demo-login-button --template typescript
   ```

1. Перейдите в новый каталог и установите пакет аутентификации `@azure/msal-browser`:

   ```bash
   cd tutorial-demo-login-button && npm install @azure/msal-browser
   ```

1. Создайте файл `.env` в папке корневого уровня и добавьте следующую строку:

    :::code language="env" source="~/../js-e2e-client-azure-login-button/.env"  :::

    Файл `.env` считывается как часть платформы create-react-app. В этом файле можно хранить идентификатор клиента для локальной разработки. 

1. Скопируйте идентификатор приложения (клиента) во второе значение.

## <a name="5-add-login-and-logoff-buttons"></a>5. Добавление кнопок входа и выхода

1. Создайте вложенную папку с именем `azure` для связанных с Azure файлов в папке `./src`. 

1. Создайте файл для конфигурации проверки подлинности в папке `azure` с именем `azure-authentication-config.ts` и скопируйте в него следующий код:

    :::code language="typescript" source="~/../js-e2e-client-azure-login-button/src/azure/azure-authentication-config.ts"  highlight="3-4,, 11-12":::

    Этот файл считывает идентификатор приложения из файла `.env`, устанавливает сеанс в качестве хранилища браузера вместо файлов cookie и обеспечивает ведение журнала с учетом персональных данных.

1. Создайте файл для ПО промежуточного слоя проверки подлинности Azure в папке `azure` с именем `azure-authentication-context.ts` и скопируйте в него следующий код:

    :::code language="typescript" source="~/../js-e2e-client-azure-login-button/src/azure/azure-authentication-context.ts"  highlight="43, 58, 65":::

    Этот файл позволяет пользователю выполнить проверку подлинности Azure с помощью функций `login` и `logout`.

1. Создайте файл для файла компонента кнопки пользовательского интерфейса в папке `azure` с именем `azure-authentication-component.tsx` и скопируйте в него следующий код:

   :::code language="typescript" source="~/../js-e2e-client-azure-login-button/src/azure/azure-authentication-component.tsx"  highlight="3, 11, 23, 29, 36":::

   Этот компонент кнопки регистрирует пользователя и передает учетную запись пользователя в вызывающий/родительский компонент.

   Текст и функциональные возможности кнопки изменяются в зависимости от того, вошел ли пользователь в систему. Сведения о состоянии входа пользователя записываются функцией `onAuthenticated` в качестве свойства, которое передается в компонент.

   Когда пользователь входит в систему, функция кнопки вызывает метод библиотеки проверки подлинности Azure (`authenticationModule.login` с `returnedAccountInfo` в качестве функции обратного вызова). Возвращенная учетная запись пользователя затем передается обратно в родительский компонент с помощью функции `onAuthenticated`.


1. Откройте файл `./src/App.tsx` и замените весь код следующим кодом, чтобы включить компонент кнопки входа/выхода:

   :::code language="typescript" source="~/../js-e2e-client-azure-login-button/src/App.tsx"  highlight="10, 37-42":::

    После входа пользователя в систему и выполнения механизмом проверки подлинности перенаправления обратно в приложение отображается объект currentUser. 

## <a name="6-run-react-spa-app-with-login-button"></a>6. Запуск одностраничного приложения React с помощью кнопки входа

1. В окне терминала Visual Studio Code запустите приложение:

    ```bash
    npm run start
    ```

1. Нажмите кнопку **Вход** в веб-браузере. 

    :::image type="content" source="../media/tutorial-login-button/create-react-app-before-authentication-login-button-display.png" alt-text="Нажмите кнопку **Вход**.":::  

1. Выберите учетную запись пользователя. Она должна отличаться от учетной записи, используемой для доступа к порталу Azure. Однако это должна быть учетная запись, которая позволяет выполнить проверку подлинности Майкрософт.

    :::image type="content" source="../media/tutorial-login-button/authentication-popup-select-user-account.png" alt-text="Выберите учетную запись пользователя. Она должна отличаться от учетной записи, используемой для доступа к порталу Azure. Однако это должна быть учетная запись, которая позволяет выполнить проверку подлинности Майкрософт.":::

1. Просмотрите всплывающее окно, в котором отображается: 1) имя пользователя; 2) имя приложения; 3) разрешения, которые вы подтвердили. Затем выберите **Да**.

    :::image type="content" source="../media/tutorial-login-button/authentication-popup-let-this-app-access-your-info.png" alt-text="Просмотрите всплывающее окно, в котором отображается: 1) имя пользователя; 2) имя приложения; 3) разрешения, которые вы подтвердили. Затем выберите &quot;Да&quot;":::.

1. Проверьте сведения об учетной записи пользователя. 

    :::image type="content" source="../media/tutorial-login-button/create-react-app-after-authentication-login-button-succeeds.png" alt-text="Проверьте сведения об учетной записи пользователя.":::  

1. В приложении нажмите кнопку **Выход**. Приложение также предоставляет все необходимые ссылки на приложения пользователя Майкрософт для отзыва разрешений. 

## <a name="7-clean-up-resources"></a>7. Очистка ресурсов

По завершении работы с этим учебником удалите приложение из [списка регистрации приложений](https://portal.azure.com/?quickstart=True#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/RegisteredApps) на портале Azure.

Если вы хотите сохранить приложение, но отменить разрешение, предоставленное приложению вашей конкретной учетной записью, используйте одну из следующих ссылок:

* [Отмена разрешения AAD](https://myapps.microsoft.com/)
* [Отмена разрешения объекта-получателя](https://account.live.com/consent/manage)

## <a name="next-steps"></a>Дальнейшие действия

Это приложение позволяет вашему приложению выполнить проверку подлинности пользователя и возвращает сведения о пользователе. Если вы используете простую версию программы, возможности проверки подлинности на этом заканчиваются. Но вы можете добавить возможность управления пользователями приложения и авторизацией пользователей в функции приложения. 

Данные управления пользователями можно сохранить в Azure Active Directory или в собственной базе данных в зависимости от выбранных функции и средств. 

Авторизация пользователей может быть выполнена в Azure. Также вы можете разработать авторизацию без Azure или объединить эти две функции для пользовательского интерфейса авторизации, ролей и функций приложения. 

* Продолжайте использовать [библиотеки MSAL](/azure/active-directory/develop/msal-overview) для получения профиля пользователя и обеспечения автоматического входа
* Добавьте [Microsoft Graph](/graph/overview), чтобы получить доступ к учетным записям пользователей в Microsoft 365, включая электронную почту и встречи в календаре